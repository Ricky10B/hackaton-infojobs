import { createSlice } from '@reduxjs/toolkit'
import { initialStateFilters } from '../consts'

const initialState = (() => {
  const filtersStore = localStorage.getItem('__FILTERS_STORE__')
  return filtersStore ? JSON.parse(filtersStore) : initialStateFilters
})()

export const filtersSlice = createSlice({
  name: 'filters',
  initialState,
  reducers: {
    setFilters: (state, action) => {
      const { name, newValueFilter, positionDataFilter, checked } = action.payload

      // Actualizaci贸n del input de filtrado
      // de chekeado o no en los dataFilters
      // de cada secci贸n de filtrado
      const newDataFilters = [...state[name].dataFilters]
      const dataFilter = {
        ...newDataFilters[positionDataFilter],
        isChecked: checked
      }
      newDataFilters[positionDataFilter] = dataFilter

      // Actualizaci贸n del valor del queryParam
      // y del dataFilters de una secci贸n de
      // filtrado especifica
      const seccionFiltrado = {
        ...state[name],
        value: newValueFilter,
        dataFilters: newDataFilters
      }

      return {
        ...state,
        [name]: seccionFiltrado
      }
    }
  }
})

export default filtersSlice.reducer

export const { setFilters } = filtersSlice.actions
